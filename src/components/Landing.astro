---
import Image from "astro/components/Image.astro";
import { ArrowRightIcon } from "./icons";
const base = (import.meta.env.BASE_URL || '/').replace(/\/?$/, '/');
const hero = {
  subtitle: "2012'DEN GÜNÜMÜZE",
  title: "KENTSEL DÖNÜŞÜME YÖN\nVEREN ÖNCÜ KURULUŞ",
  ctaText: "Projelere Göz At",
  ctaLink: `${base}projeler`,
};
---

<section class="relative w-full min-h-screen flex items-center justify-center overflow-hidden" id="hero-slider">
  <div class="absolute inset-0 z-0">
    <Image 
      src={`${import.meta.env.BASE_URL}landing-photo.png`} 
      alt="Construction Image" 
      width={1920} 
      height={1080} 
      class="w-full h-full object-cover" 
    />
  </div>
  
  <div class="absolute inset-0 z-10 bg-black/25"></div>
  
  <div class="relative z-20 w-full h-full py-16 sm:py-20 md:py-24">
    <div class="absolute inset-0 flex items-center justify-center px-4 sm:px-6 ">
      <div class="hero-text text-center w-full max-w-[1400px] mx-auto" data-hero-text>
        <p class="text-[#E30A17] text-xs sm:text-sm md:text-base lg:text-lg xl:text-xl 2xl:text-3xl font-bold mb-3 sm:mb-4 md:mb-5 tracking-wider ">
          {hero.subtitle}
        </p>
        <h1 class="text-white text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl 2xl:text-8xl font-medium mb-6 sm:mb-7 md:mb-8 leading-tight whitespace-pre-line">
          {hero.title}
        </h1>
        <a
          href={hero.ctaLink}
          class="inline-flex items-center gap-2 rounded-full bg-[#E30A17] px-4 py-2.5 sm:px-6 sm:py-3 md:px-8 md:py-4 text-sm sm:text-base font-medium text-white hover:bg-[#e30a18df] transition"
        >
          {hero.ctaText}
          <ArrowRightIcon />
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  const heroText = document.querySelector('[data-hero-text]');
  if (!heroText) {
    // no-op
  } else {
    const el = heroText as HTMLElement;
    let hasStarted = false;
    let hideTimer: number | undefined;

    const start = () => {
      if (hasStarted) return;
      hasStarted = true;

      el.classList.add('is-visible');

      // birkaç saniye sonra kaybolsun
      hideTimer = window.setTimeout(() => {
        el.classList.add('is-hidden');
      }, 3500);
    };

    if ('IntersectionObserver' in window) {
      const io = new IntersectionObserver(
        (entries) => {
          const entry = entries[0];
          if (entry?.isIntersecting) {
            start();
            io.disconnect();
          }
        },
        { threshold: 0.35 }
      );

      io.observe(el);
      window.addEventListener('beforeunload', () => {
        if (hideTimer) window.clearTimeout(hideTimer);
        io.disconnect();
      });
    } else {
      start();
    }
  }
</script>

<style>
  .hero-text {
    opacity: 0;
    transform: translateY(16px);
    filter: blur(6px);
    transition: opacity 700ms ease, transform 700ms cubic-bezier(0.2, 0.8, 0.2, 1), filter 700ms ease;
    will-change: opacity, transform, filter;
  }

  .hero-text.is-visible {
    opacity: 1;
    transform: translateY(0);
    filter: blur(0);
  }

  .hero-text.is-hidden {
    opacity: 0;
    transform: translateY(-10px);
    filter: blur(6px);
    pointer-events: none;
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-text {
      transition: none;
      transform: none;
      filter: none;
    }
    .hero-text.is-visible {
      opacity: 1;
    }
    .hero-text.is-hidden {
      opacity: 0;
    }
  }
</style>
